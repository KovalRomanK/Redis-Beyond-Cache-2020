import React from 'react';

import { Snackbar, Button, Grid, SnackbarCloseReason } from '@material-ui/core';
import Alert from '@material-ui/lab/Alert';
import { useQueryParam, StringParam, JsonParam } from 'use-query-params';
import { navigate } from 'gatsby';
import {  useStore } from 'react-redux';

import Layout from '../components/layout';
import { store } from '../stores/auth';

const IndexPage = () => {
  // const [code] = useQueryParam('code', NumberParam);
  const [data]: [SpotifySession, any] = useQueryParam('data', JsonParam);
  const [error] = useQueryParam('error', StringParam);

  const store=  useStore(store);

  if (data) actions.loginAction(data);

  const isLoggedIn = useSelector<SpotifySession>((state) => state.);

  if (!isLoggedIn()) {
    if (isBrowser()) navigate('/login', { replace: true });
    return null;
  }

  const [open, setOpen] = React.useState(!!error);

  const handleClose = (event: React.SyntheticEvent<any>, reason: SnackbarCloseReason) => {
    if (reason === 'clickaway') return;
    setOpen(false);
  };

  return (
    <>
      <Layout title="🏡 Home">
        <Grid
          className="fill-height"
          container
          direction="column"
          justify="center"
          alignItems="center"
        >
          Index
        </Grid>
      </Layout>
      <Snackbar open={open} autoHideDuration={4000} onClose={handleClose}>
        <Alert elevation={6} variant="filled" color="error">
          {error}
        </Alert>
      </Snackbar>
    </>
  );
};

export default IndexPage;
